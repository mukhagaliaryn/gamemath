{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}
    {{ quiz_control.quiz.title }} | GameMath
{% endblock title %}


{% block content %}
<div class="bg-{{ ''|random_tailwind_color }} h-screen overflow-auto">
    {% if quiz_control.status == 'FINISHED' %}
        <div class="max-w-2xl w-full mx-auto py-20 text-center">
            <h1 class="text-6xl font-bold">Ойын аяталған!</h1>
        </div>
    {% else %}
    <div class="relative flex justify-center">
        <div class="fixed top-5 right-10 grid gap-2 p-6 rounded-xl bg-white">
            <h1 class="text-3xl text-gray-900 font-bold">{{ quiz_control.quiz.title }}</h1>
            <div class="flex gap-2 items-center">
                <div class="bg-{{ ''|random_tailwind_color }} w-10 h-10 flex justify-center items-center rounded-full">
                    <span class="text-2xl font-bold text-white">{{ user_quiz.username|first_upper }}</span>
                </div>  
                <h1 class="text-xl font-bold text-gray-900">{{ user_quiz.username }}</h1>
            </div>
        </div>

        <form method="post" class="max-w-screen-lg w-full grid gap-16 mx-auto py-10">
            {% csrf_token %}
            {% for question in quiz_control.quiz.quiz_questions.all %}
                <div class="grid gap-4">
                    <div class="flex items-end gap-4 text-2xl font-semibold">
                        <h1 class="text-6xl font-black text-white">{{ forloop.counter }}</h1>
                        <h1 class="">{{ question.question_body|safe }}</h1>
                    </div>
                    <div class="grid gap-4 grid-cols-2">
                        {% for option in question.q_options.all %}
                            <div class="flex items-center gap-2 p-6 rounded-xl bg-white">
                                <input 
                                    id="option_{{ option.id }}" 
                                    type="radio" value="{{ option.id }}" 
                                    name="question_{{ question.id }}" 
                                    class="w-8 h-8 text-orange-500 border-4 border-orange-300 focus:ring-orange-500 focus:ring-2 transition-all cursor-pointer"
                                    onclick="playAudio('click-audio')"
                                >
                                <label for="option_{{ option.id }}" class="ms-2 font-medium text-gray-900 flex-1 cursor-pointer">
                                    {{ option.option_body|safe }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
            <button 
                type="submit"
                class="fixed bottom-5 right-10 py-4 px-8 font-semibold bg-white text-gray-900 rounded-lg transition-all hover:scale-105 active:scale-95"
                onclick="finishTest('finish-audio')"
            >
                Ойынды аяқтау
            </button>
        </form>
        <audio id="click-audio" src="{% static '/audio/option_click-1.wav' %}"></audio>
        <audio id="finish-audio" src="{% static '/audio/option_click-2.wav' %}"></audio>
    </div>
    {% endif %}
</div>
{% endblock content %}




<!-- {% if show_modal %}
<div class="relative">
    <h1>{{ user_quiz.username }}</h1>
    <h1>{{ quiz_control.quiz.title }}</h1>
    
    <div>
        <form method="post">
            {% csrf_token %}
            {% for question in quiz_control.quiz.quiz_questions.all %}
                <div>
                    <h2>{{ question.question_body|safe }}</h2>
                    {% for option in question.options.all %}
                        <label>
                            <input type="checkbox" name="question_{{ question.id }}" value="{{ option.id }}">
                            {{ option.option_body|safe }}
                        </label>
                    {% endfor %}
                </div>
            {% endfor %}
            <button type="submit">Отправить ответы</button>
        </form>
    </div>
</div>
{% else %}
<div class="w-full h-full flex justify-center items-center">
    <div class="max-w-md w-full text-center grid gap-4">
        <img 
            src="{{ quiz_control.quiz.poster.url }}" alt=""
            class="w-64 mx-auto"    
        >
        <h2 class="text-4xl font-bold">Ойын кіру үшін атыңды жаз</h2>
        <form method="post" class="grid gap-2 px-8">
            {% csrf_token %}
            <input 
                type="text" id="username" name="username" required
                placeholder="Атыңды жаз"
                class="w-full rounded-lg border-transparent text-gray-900"
            >
            <button 
                type="submit"
                class="w-full flex items-center justify-center font-semibold bg-white text-red-500 py-2 rounded-lg transition-all hover:scale-105"
            >
                <svg class="w-8 h-8" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M8.6 5.2A1 1 0 0 0 7 6v12a1 1 0 0 0 1.6.8l8-6a1 1 0 0 0 0-1.6l-8-6Z" clip-rule="evenodd"/>
                </svg>
                
                Ойынға кіру
            </button>
        </form>
    </div>
</div>
{% endif %} -->